import XCTest
import State

class TemplateTests: Test {
    
    func testEncodingAndDecodingAutoGeneratedModel() {
        var company = Company(name: "State llc",yearFounded: 2015, phoneNumber: "888-888-8888",  employees: [Employee]())
        let employee = Employee(name:"Joe", title: "CEO")
        company.employees?.append(employee)
        let data = company.encode()
        Plist.write(data, path: tempPathFor("company.plist"))
        let testCompany = Company(.plist, path: tempPathFor("company.plist"))
        
        XCTAssert(testCompany != nil)
        XCTAssert(testCompany?.name == "State llc")
        XCTAssert(testCompany?.phoneNumber == "888-888-8888")
        XCTAssert(testCompany?.yearFounded == 2015)
        XCTAssert(testCompany?.employees?.count == 1)
        XCTAssert(testCompany?.employees?[0].name == "Joe")
    }
    
    func testTypes() {
        let test_out = TestTypes()
        test_out.save(.binary, path: tempPathFor("test_types.plist"))
        let sut = TestTypes(.binary, path: tempPathFor("test_types.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut?.myBinary != nil)
        XCTAssert(sut?.myDate != nil)
        XCTAssert(sut?.myFloat == 4.567)
        XCTAssert(sut?.myDouble == -0.02)
        XCTAssert(sut?.myInt == 5)
        XCTAssert(sut?.myString == "Hello World")
        XCTAssert(sut?.myDecimal == 3.14)
    }
    
    func testImmutableTypes() {
        let test_out = TestImmutableTypes()
        test_out.save(.binary, path: tempPathFor("test_immutable_types.plist"))
        let sut = TestImmutableTypes(.binary, path: tempPathFor("test_immutable_types.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut?.myBinary != nil)
        XCTAssert(sut?.myDate != nil)
        XCTAssert(sut?.myFloat == 4.567)
        XCTAssert(sut?.myDouble == -0.02)
        XCTAssert(sut?.myInt == 5)
        XCTAssert(sut?.myString == "Hello World")
        XCTAssert(sut?.myDecimal == 3.14)
    }

    func testOptionalTypes() {
        let test_out = TestOptionalTypes.CreateTestInstance()
        test_out.save(.binary, path: tempPathFor("test_optional_types.plist"))
        let sut =  TestOptionalTypes(.binary, path: tempPathFor("test_optional_types.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut?.myBinary != nil)
        XCTAssert(sut?.myDate != nil)
        XCTAssert(sut?.myFloat == 4.567)
        XCTAssert(sut?.myDouble == -0.02)
        XCTAssert(sut?.myInt == 5)
        XCTAssert(sut?.myString == "Hello World")
        XCTAssert(sut?.myDecimal == 3.14)
    }
    
    func testImmutableOptionalTypes() {
        let test_out = TestImmutableOptionalTypes()
        test_out.save(.binary, path: tempPathFor("test_immutable_optional_types.plist"))
        let sut = TestImmutableOptionalTypes(.binary, path: tempPathFor("test_immutable_optional_types.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut?.myBinary != nil)
        XCTAssert(sut?.myDate != nil)
        XCTAssert(sut?.myFloat == 4.567)
        XCTAssert(sut?.myDouble == -0.02)
        XCTAssert(sut?.myInt == 5)
        XCTAssert(sut?.myString == "Hello World")
        XCTAssert(sut?.myDecimal == 3.14)
    }

    func testCollections() {
        var test_out = TestCollections()
        test_out.arrayOfStrings = ["string1", "string2", "string3"]
        test_out.dicOfInts["int1"] = 1
        test_out.dicOfInts["int2"] = 2
        test_out.dicOfInts["int3"] = 3
        test_out.setOfStrings = ["do", "ray", "me"]
        test_out.save(.binary, path: tempPathFor("test_collections.plist"))
        let sut =  TestCollections(.binary, path: tempPathFor("test_collections.plist"))
        
        XCTAssert(sut != nil)
        XCTAssert(sut?.arrayOfStrings.count == 3)
        XCTAssert(sut?.dicOfInts.count == 3)
        XCTAssert(sut?.setOfStrings.count == 3)
    }
    
    func testRawEnum() {
        let test_out = TestRawEnum.ready
        test_out.save(.plist, path: tempPathFor("test_enum.plist"))
        let sut = TestRawEnum(.plist, path: tempPathFor("test_enum.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut == TestRawEnum.ready)
    }
    
    func testTransformable() {
        let test_out = TestTransformable( myTransformable: URL(string: "http://facebook.com")!, myTransformableImmutable: URL(string: "http://yahoo.com")!, myTransformableImmutableOptional: nil, myTransformableOptional:URL(string: "http://twitter.com")!)
        test_out.save(.binary, path: tempPathFor("test_transformable.plist"))
        let sut =  TestTransformable(.binary, path: tempPathFor("test_transformable.plist"))
        XCTAssert(sut != nil)
        XCTAssert(sut?.myTransformable == test_out.myTransformable)
        XCTAssert(sut?.myTransformableImmutable == test_out.myTransformableImmutable)
        XCTAssert(sut?.myTransformableImmutableOptional == test_out.myTransformableImmutableOptional)
        XCTAssert(sut?.myTransformableOptional == test_out.myTransformableOptional)
    }
    
    func testOverrideType() {
        let test_out: TestOverrideType? = TestOverrideType(myURL: URL(string: "http://simpletouchsoftware.com"), myArrayOfString: ["string1", "string2"])
        XCTAssert(test_out != nil)
    }
}
